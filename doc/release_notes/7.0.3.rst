Fixes

* Performance improvements and internal refactoring as suggested by ``ruff`` linter.
